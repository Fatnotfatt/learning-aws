<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.152.2"><meta name=description content><meta name=author content="thienlh@thienlu.com"><link rel=icon href=/learning-aws/images/favicon.png type=image/png><title>Blog 3 :: Internship Report</title><link href=/learning-aws/css/nucleus.css?1765009877 rel=stylesheet><link href=/learning-aws/css/fontawesome-all.min.css?1765009877 rel=stylesheet><link href=/learning-aws/css/hybrid.css?1765009877 rel=stylesheet><link href=/learning-aws/css/featherlight.min.css?1765009877 rel=stylesheet><link href=/learning-aws/css/perfect-scrollbar.min.css?1765009877 rel=stylesheet><link href=/learning-aws/css/auto-complete.css?1765009877 rel=stylesheet><link href=/learning-aws/css/atom-one-dark-reasonable.css?1765009877 rel=stylesheet><link href=/learning-aws/css/theme.css?1765009877 rel=stylesheet><link href=/learning-aws/css/tabs.css?1765009877 rel=stylesheet><link href=/learning-aws/css/hugo-theme.css?1765009877 rel=stylesheet><link href=/learning-aws/css/theme-workshop.css?1765009877 rel=stylesheet><script src=/learning-aws/js/jquery-3.3.1.min.js?1765009877></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/learning-aws/3-blogstranslated/3.3-blog3/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=/><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/learning-aws/js/lunr.min.js?1765009877></script><script type=text/javascript src=/learning-aws/js/auto-complete.js?1765009877></script><script type=text/javascript>var baseurl="https://Fatnotfatt.github.io/learning-aws/"</script><script type=text/javascript src=/learning-aws/js/search.js?1765009877></script></div><section id=homelinks><ul><li><a class=padding href=/><i class='fas fa-home'></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/learning-aws/1-worklog/ title=Worklog class=dd-item><a href=/learning-aws/1-worklog/><b>1. </b>Worklog
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/learning-aws/1-worklog/1.11-week11/ title="Worklog Week 11" class=dd-item><a href=/learning-aws/1-worklog/1.11-week11/><b>1.11. </b>Worklog Week 11
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/1-worklog/1.10-week10/ title="Worklog Week 10" class=dd-item><a href=/learning-aws/1-worklog/1.10-week10/><b>1.10. </b>Worklog Week 10
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/1-worklog/1.9-week9/ title="Worklog Week 9" class=dd-item><a href=/learning-aws/1-worklog/1.9-week9/><b>1.9. </b>Worklog Week 9
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/1-worklog/1.8-week8/ title="Worklog Week 8" class=dd-item><a href=/learning-aws/1-worklog/1.8-week8/><b>1.8. </b>Worklog Week 8
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/1-worklog/1.7-week7/ title="Worklog Week 7" class=dd-item><a href=/learning-aws/1-worklog/1.7-week7/><b>1.7. </b>Worklog Week 7
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/1-worklog/1.6-week6/ title="Worklog Week 6" class=dd-item><a href=/learning-aws/1-worklog/1.6-week6/><b>1.6. </b>Worklog Week 6
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/1-worklog/1.5-week5/ title="Worklog Week 5" class=dd-item><a href=/learning-aws/1-worklog/1.5-week5/><b>1.5. </b>Worklog Week 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/1-worklog/1.4-week4/ title="Worklog Week 4" class=dd-item><a href=/learning-aws/1-worklog/1.4-week4/><b>1.4. </b>Worklog Week 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/1-worklog/1.3-week3/ title="Worklog Week 3" class=dd-item><a href=/learning-aws/1-worklog/1.3-week3/><b>1.3. </b>Worklog Week 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/1-worklog/1.1-week1/ title="Week 1 Worklog" class=dd-item><a href=/learning-aws/1-worklog/1.1-week1/><b>1.1. </b>Week 1 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/1-worklog/1.2-week2/ title="Worklog Week 2" class=dd-item><a href=/learning-aws/1-worklog/1.2-week2/><b>1.2. </b>Worklog Week 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/1-worklog/1.12-week12/ title="Week 12 Worklog" class=dd-item><a href=/learning-aws/1-worklog/1.12-week12/><b>1.12. </b>Week 12 Worklog
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/learning-aws/2-proposal/ title=Proposal class=dd-item><a href=/learning-aws/2-proposal/><b>2. </b>Proposal
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/3-blogstranslated/ title="Translated Blogs" class="dd-item
parent"><a href=/learning-aws/3-blogstranslated/><b>3. </b>Translated Blogs
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/learning-aws/3-blogstranslated/3.1-blog1/ title="Blog 1" class=dd-item><a href=/learning-aws/3-blogstranslated/3.1-blog1/><b>3.1. </b>Blog 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/3-blogstranslated/3.2-blog2/ title="Blog 2" class=dd-item><a href=/learning-aws/3-blogstranslated/3.2-blog2/><b>3.2. </b>Blog 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/3-blogstranslated/3.3-blog3/ title="Blog 3" class="dd-item
active"><a href=/learning-aws/3-blogstranslated/3.3-blog3/><b>3.3. </b>Blog 3
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/learning-aws/4-eventparticipated/ title="Events Participated" class=dd-item><a href=/learning-aws/4-eventparticipated/><b>4. </b>Events Participated
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/learning-aws/4-eventparticipated/4.5-event5/ title="Event 5" class=dd-item><a href=/learning-aws/4-eventparticipated/4.5-event5/><b>4.5. </b>Event 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/4-eventparticipated/4.4-event4/ title="Event 4" class=dd-item><a href=/learning-aws/4-eventparticipated/4.4-event4/><b>4.4. </b>Event 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/4-eventparticipated/4.1-event1/ title="Event 1" class=dd-item><a href=/learning-aws/4-eventparticipated/4.1-event1/><b>4.1. </b>Event 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/4-eventparticipated/4.2-event2/ title="Event 2" class=dd-item><a href=/learning-aws/4-eventparticipated/4.2-event2/><b>4.2. </b>Event 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/4-eventparticipated/4.3-event3/ title="Event 3" class=dd-item><a href=/learning-aws/4-eventparticipated/4.3-event3/><b>4.3. </b>Event 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/4-eventparticipated/4.6-event6/ title="Event 6" class=dd-item><a href=/learning-aws/4-eventparticipated/4.6-event6/><b>4.6. </b>Event 6
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/learning-aws/5-workshop/ title=Workshop class=dd-item><a href=/learning-aws/5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/learning-aws/5-workshop/5.1-workshop-overview/ title=Introduction class=dd-item><a href=/learning-aws/5-workshop/5.1-workshop-overview/><b>5.1. </b>Introduction
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/5-workshop/5.2-prerequiste/ title=Prerequiste class=dd-item><a href=/learning-aws/5-workshop/5.2-prerequiste/><b>5.2. </b>Prerequiste
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/5-workshop/5.3-s3-vpc/ title="Access S3 from VPC" class=dd-item><a href=/learning-aws/5-workshop/5.3-s3-vpc/><b>5.3. </b>Access S3 from VPC
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/learning-aws/5-workshop/5.3-s3-vpc/5.3.1-create-gwe/ title="Create a gateway endpoint" class=dd-item><a href=/learning-aws/5-workshop/5.3-s3-vpc/5.3.1-create-gwe/><b>5.3.1 </b>Create a gateway endpoint
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/5-workshop/5.3-s3-vpc/5.3.2-test-gwe/ title="Test the Gateway Endpoint" class=dd-item><a href=/learning-aws/5-workshop/5.3-s3-vpc/5.3.2-test-gwe/><b>5.3.2 </b>Test the Gateway Endpoint
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/learning-aws/5-workshop/5.4-s3-onprem/ title="Access S3 from on-premises" class=dd-item><a href=/learning-aws/5-workshop/5.4-s3-onprem/><b>5.4. </b>Access S3 from on-premises
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/learning-aws/5-workshop/5.4-s3-onprem/5.4.1-prepare/ title="Prepare the environment" class=dd-item><a href=/learning-aws/5-workshop/5.4-s3-onprem/5.4.1-prepare/><b>5.4.1 </b>Prepare the environment
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/5-workshop/5.4-s3-onprem/5.4.2-create-interface-enpoint/ title="Create an S3 Interface endpoint" class=dd-item><a href=/learning-aws/5-workshop/5.4-s3-onprem/5.4.2-create-interface-enpoint/><b>5.4.2 </b>Create an S3 Interface endpoint
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/5-workshop/5.4-s3-onprem/5.4.3-test-endpoint/ title="Test the Interface Endpoint" class=dd-item><a href=/learning-aws/5-workshop/5.4-s3-onprem/5.4.3-test-endpoint/><b>5.4.3 </b>Test the Interface Endpoint
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/5-workshop/5.4-s3-onprem/5.4.4-dns-simulation/ title="On-premises DNS Simulation" class=dd-item><a href=/learning-aws/5-workshop/5.4-s3-onprem/5.4.4-dns-simulation/><b>5.4.4 </b>On-premises DNS Simulation
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/learning-aws/5-workshop/5.5-policy/ title="VPC Endpoint Policies" class=dd-item><a href=/learning-aws/5-workshop/5.5-policy/><b>5.5. </b>VPC Endpoint Policies
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/5-workshop/5.6-cleanup/ title="Clean up" class=dd-item><a href=/learning-aws/5-workshop/5.6-cleanup/><b>5.6. </b>Clean up
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/learning-aws/6-self-evaluation/ title=Self-Assessment class=dd-item><a href=/learning-aws/6-self-evaluation/><b>6. </b>Self-Assessment
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/learning-aws/7-feedback/ title="Sharing and Feedback" class=dd-item><a href=/learning-aws/7-feedback/><b>7. </b>Sharing and Feedback
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://Fatnotfatt.github.io/learning-aws/3-blogstranslated/3.3-blog3/ selected>English</option><option id=vi value=https://Fatnotfatt.github.io/learning-aws/vi/3-blogstranslated/3.3-blog3/>Tiếng Việt</option></select>
<svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/learning-aws/>Internship Report</a> > <a href=/learning-aws/3-blogstranslated/>Translated Blogs</a> > Blog 3</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#prerequisites><strong>Prerequisites</strong></a></li><li><a href=#full-text-search-in-postgresql><strong>Full-text search in PostgreSQL</strong></a><ul><li><a href=#contains-predicate-with-and-operator><strong>CONTAINS predicate with AND operator</strong></a></li><li><a href=#contains-predicate-with-or-operator><strong>CONTAINS predicate with OR operator</strong></a></li><li><a href=#freetext-predicate><strong>FREETEXT predicate</strong></a></li><li><a href=#freetexttable-function-with-rank><strong>FREETEXTTABLE function with RANK</strong></a></li><li><a href=#containstable-and-formsof-functions-with-rank><strong>CONTAINSTABLE and FORMSOF functions with RANK</strong></a></li></ul></li><li><a href=#improving-query-performance-in-postgresql><strong>Improving query performance in PostgreSQL</strong></a><ul><li><a href=#solution-1-using-gin-index><strong>Solution 1: Using GIN index</strong></a></li><li><a href=#solution-2-using-stored-generated-column><strong>Solution 2: Using stored generated column</strong></a></li></ul></li><li><a href=#full-text-search-in-postgresql-using-the-pg_><strong>Full-text search in PostgreSQL using the pg_trgm extension</strong></a></li><li><a href=#full-text-search-in-postgresql-using-the-pg_-1><strong>Full-text search in PostgreSQL using the pg_bigm extension</strong></a></li><li><a href=#conclusion><strong>Conclusion</strong></a><ul><li></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Blog 3</h1><h1 id=migrating-full-text-search-from-sql-server-to-amazon-aurora-postgresql-compatible-edition-or-amazon-rds-for-postgresql><strong>Migrating full-text search from SQL Server to Amazon Aurora PostgreSQL-Compatible Edition or Amazon RDS for PostgreSQL</strong></h1><hr><p>Authors: Sivaprasad Appana, Surya Nallu, and Saumitra Das</p><p>Published: August 19, 2024</p><hr><p>In today&rsquo;s data world, the ability to find and retrieve information from large datasets is crucial. While some database management systems (both commercial and open source) excel at handling structured data, PostgreSQL also provides powerful tools for searching unstructured or semi-structured data. PostgreSQL has built-in full-text search (FTS) capabilities, and also supports extensions like pg_trgm and pg_bigm for text search.</p><p>Traditional queries using the LIKE, ILIKE operators or regular expressions are well-suited for finding exact strings or structured data, but have limitations when searching within large text fields such as documents, articles, or product descriptions.</p><p>When migrating from a commercial database like SQL Server to PostgreSQL (such as Amazon Aurora PostgreSQL-Compatible or Amazon RDS for PostgreSQL), migrating full-text search requires modifying queries and schema structure, as the FTS implementation differs between the two systems. The AWS Schema Conversion Tool (AWS SCT) does not automatically convert full-text search related code.</p><p>SQL Server FTS is designed to find words, phrases, or word forms (stemming) in unstructured text data. It supports fast searching, ranking, and text indexing, helping applications efficiently process large amounts of text information.</p><p>In this article, we will guide you on how to migrate full-text search from SQL Server to Amazon Aurora PostgreSQL by using the tsvector and tsquery data types. We will also show how to implement FTS using the pg_trgm and pg_bigm extensions.</p><hr><h2 id=prerequisites><strong>Prerequisites</strong></h2><p>In this article, we use the AdventureWorks2019 sample database to illustrate how to migrate FTS from SQL Server 2019 Standard to PostgreSQL.</p><p>The main steps to set up FTS in SQL Server:</p><ol><li>Enable full-text search for the AdventureWorks2019 database:</li></ol><p>USE [AdventureWorks2019]<br>GO<br>EXEC sp_fulltext_database &rsquo;enable&rsquo;<br>GO</p><ol start=2><li>Create a full-text catalog:</li></ol><p>CREATE FULLTEXT CATALOG DescFTSCatalog;</p><p>GO</p><p>A full-text catalog is a logical component for managing full-text indexes, defining word breakers and stemmers by language.</p><ol start=3><li>Define a full-text index for columns containing text data that you want to search:</li></ol><p>CREATE FULLTEXT INDEX<br>ON<br>[AdventureWorks2019].[Production].<a href=[Description]>ProductDescription</a><br>KEY INDEX [PK_ProductDescription_ProductDescriptionID]<br>ON DescFTSCatalog<br>GO</p><ol start=4><li>Use AWS SCT and AWS Database Migration Service (AWS DMS) to migrate the AdventureWorks 2019 database from SQL Server to Amazon Aurora PostgreSQL. In this article, we migrate the Product Description table.</li></ol><p>PostgreSQL has several options for searching text: exact matching, pattern matching, regular expressions, and full-text search. In the following sections, we will guide you on how to use FTS in PostgreSQL on the migrated database to achieve similar results.</p><h2 id=full-text-search-in-postgresql><strong>Full-text search in PostgreSQL</strong></h2><p>The LIKE, ILIKE operators and regular expressions are used in the WHERE clause for pattern matching. However, LIKE/ILIKE do not support ranking and typically ignore words such as &ldquo;the&rdquo;, &ldquo;is&rdquo;, etc. PostgreSQL provides FTS by using tsvector and tsquery, along with related functions, operators, and parameters.</p><ul><li><p>tsvector: a data type representing the processed version of text (word tokenization, removal of stop words, reduction to lexemes), optimized for fast text searching. The to_tsvector function converts text to tsvector.</p></li><li><p>tsquery: contains one or more lexemes used for searching. Lexemes can be combined with operators to create complex search conditions. The to_tsquery or plainto_tsquery function converts search queries to tsquery.</p></li></ul><p>Example: &ldquo;He is running in the park&rdquo; → the words &ldquo;he&rdquo;, &ldquo;run&rdquo;, &ldquo;park&rdquo; after removing stop words and stemming.</p><h3 id=contains-predicate-with-and-operator><strong>CONTAINS predicate with AND operator</strong></h3><p>A simple FTS query in SQL Server uses the <a href="https://learn.microsoft.com/en-us/sql/t-sql/queries/contains-transact-sql?view=sql-server-ver16">CONTAINS</a> predicate. The CONTAINS predicate in Transact-SQL provides a flexible way to perform advanced FTS in SQL Server databases. It supports multiple search conditions, fuzzy searching, wildcards, and thesaurus features, allowing you to customize queries to meet specific requirements.</p><p>In the following sample query, the CONTAINS predicate checks for the words &ldquo;entry&rdquo; and &ldquo;level&rdquo; in the Description column:</p><p>SELECT ProductDescriptionID,Description</p><p>FROM [AdventureWorks2019].[Production].[ProductDescription]</p><p>WHERE CONTAINS([Description], &rsquo;entry & level&rsquo;);</p><p><img src=/learning-aws/3-blogstranslated/3.3-blog3/image/image14.jpg alt=image14.jpg></p><h3 id=contains-predicate-with-or-operator><strong>CONTAINS predicate with OR operator</strong></h3><p>This is similar to the previous use case using the CONTAINS predicate, except the check is performed using the OR operator. In the following sample query, the predicate checks for &ldquo;entry&rdquo;, &ldquo;level&rdquo;, or both:</p><p>SELECT ProductDescriptionID,Description<br>FROM [AdventureWorks2019].[Production].[ProductDescription]<br>WHERE CONTAINS([Description], &rsquo;entry | level&rsquo;);</p><p>You can rewrite the query in PostgreSQL by using the to_tsvector and to_tsquery functions as follows and using the default built-in text search dictionary value of pg_catalog.simple.</p><p><img src=/learning-aws/3-blogstranslated/3.3-blog3/image/image12.jpg alt=image12.jpg></p><h3 id=freetext-predicate><strong>FREETEXT predicate</strong></h3><p>The <a href="https://learn.microsoft.com/en-us/sql/t-sql/queries/freetext-transact-sql?view=sql-server-ver16">FREETEXT</a> predicate in <a href="https://learn.microsoft.com/en-us/sql/t-sql/language-reference?view=sql-server-ver16">Transact-SQL</a> (T-SQL) is used to perform full-text search in SQL Server databases. Unlike the CONTAINS function, which requires specific terms and conditions, the FREETEXT predicate allows more flexible and natural language-based searching.</p><p>In the following sample queries, FREETEXT checks for the words &ldquo;entry&rdquo; or &ldquo;level&rdquo; and their forms (using inflection) in the Description column:</p><p>SELECT ProductDescriptionID, Description<br>FROM [AdventureWorks2019].[Production].[Product description]<br>WHERE FREETEXT([Description], &rsquo;entry level&rsquo;);</p><p>You can rewrite the query in PostgreSQL using the to_tsvector and to_tsquery functions as follows with the pg_catalog.english configuration value. This configuration uses english_stem and a simple dictionary to convert tokens to lexemes. Therefore, a lexeme represents a normalized form of a word or token that can be indexed and used for search operations.</p><p><img src=/learning-aws/3-blogstranslated/3.3-blog3/image/image1.jpg alt=image1.jpg></p><h3 id=freetexttable-function-with-rank><strong>FREETEXTTABLE function with RANK</strong></h3><p>FTS in SQL Server can generate an optional score (or rank value) that represents the relevance of data returned by the full-text query. This rank value is calculated per row and can be used as a sorting criterion to order the query result set by relevance. The rank value only shows the relative relevance order of rows in the result set. The actual value is not important and often differs each time you run the query. The rank value has no meaning between queries.</p><p>In the following sample queries, <a href="https://learn.microsoft.com/en-us/sql/relational-databases/system-functions/freetexttable-transact-sql?view=sql-server-ver16">FREETEXTTABLE</a> checks for the words &ldquo;entry&rdquo; or &ldquo;level&rdquo; and their forms (using inflection) in the Description column and also retrieves RANK information:</p><p>SELECT FT_TBL.[ProductDescriptionID],FT_TBL.[Description], KEY_TBL.[RANK]</p><p>FROM [AdventureWorks2019].[Production].[ProductDescription] FT_TBL</p><p>INNER JOIN FREETEXTTABLE([AdventureWorks2019].[Production].[ProductDescription], [Description], &rsquo;entry OR level&rsquo;,1033) AS KEY_TBL</p><pre><code>  ON  FT\_TBL.[ProductDescriptionID] \=KEY\_TBL.[KEY]
</code></pre><p>ORDER BY KEY_TBL.[RANK] DESC,FT_TBL.[ProductDescriptionID];</p><p>In PostgreSQL, the <a href=https://www.postgresql.org/docs/current/textsearch-controls.html#TEXTSEARCH-RANKING>ts_rank</a> function is used to calculate the relevance rank of search results based on how well they match a specific query. The rank is calculated using a numeric value indicating how well the document matches the search terms in the query.</p><p><img src=/learning-aws/3-blogstranslated/3.3-blog3/image/image6.jpg alt=image6.jpg></p><p>The <a href=https://www.postgresql.org/docs/current/textsearch-controls.html#TEXTSEARCH-HEADLINE>ts_headline</a> function is used to create a text summary version of the document, highlighting the most relevant portions that match the specific search query. This function is useful for creating excerpts or search result headlines, providing context to users about why a particular document matches their search. The following screenshot shows the results of the PostgreSQL query headline column created using the ts_headline function.</p><p><img src=/learning-aws/3-blogstranslated/3.3-blog3/image/image10.png alt=image10.png>![][image5]</p><h3 id=containstable-and-formsof-functions-with-rank><strong>CONTAINSTABLE and FORMSOF functions with RANK</strong></h3><p><strong>The <a href="https://learn.microsoft.com/en-us/previous-versions/office/developer/exchange-server-2003/aa123618%28v=exchg.65%29">FORMSOF</a> function in SQL Server is used to perform <em>inflectional search</em>. Inflectional search involves searching for different forms of a word, such as plural forms, verb tenses, or related word forms. This can help you find relevant documents even when they contain variations of the search term, thus improving search accuracy.</strong></p><p><strong>In the following sample queries, <a href="https://learn.microsoft.com/en-us/sql/relational-databases/system-functions/containstable-transact-sql?view=sql-server-ver16">CONTAINSTABLE</a> checks for the word &ldquo;gear&rdquo; and its forms (using INFLECTIONAL) in the Description column and also retrieves RANK information:</strong></p><p><strong>SELECT FT_TBL.[ProductDescriptionID],FT_TBL.[Description], KEY_TBL.[RANK]</strong></p><p><strong>FROM [AdventureWorks2019].[Production].[ProductDescription] FT_TBL</strong></p><pre><code>**INNER JOIN CONTAINSTABLE([AdventureWorks2019].[Production].[ProductDescription],**

                         **[Description], 'FORMSOF(INFLECTIONAL,''gear'')',1033)**
</code></pre><p><strong>AS KEY_TBL</strong></p><p><strong>ON FT_TBL.[ProductDescriptionID] = KEY_TBL.[KEY]</strong></p><p><strong>ORDER BY KEY_TBL.[RANK] DESC,FT_TBL.[ProductDescriptionID];</strong></p><p><strong>In PostgreSQL queries, phrases are first broken down into words or tokens, and these words are normalized and classified into root words (lexemes) using the pg_catalog.english FTS configuration. These lexemes will be the same for different forms (inflections) of a word. Therefore, this feature automatically handles inflectional searches.</strong></p><table><thead><tr><th style=text-align:left>SQL Server</th></tr></thead><tbody><tr><td style=text-align:left><strong>SELECT FT_TBL.[ProductDescriptionID],FT_TBL.[Description], KEY_TBL.[RANK] FROM [AdventureWorks2019].[Production].[ProductDescription] FT_TBL INNER JOIN CONTAINSTABLE([AdventureWorks2019].[Production].[ProductDescription], [Description], &lsquo;FORMSOF(INFLECTIONAL,&lsquo;&lsquo;gear&rsquo;&rsquo;)&rsquo;,1033) AS KEY_TBL ON FT_TBL.[ProductDescriptionID] = KEY_TBL.[KEY] ORDER BY KEY_TBL.[RANK] DESC,FT_TBL.[ProductDescriptionID]; <img src=/learning-aws/3-blogstranslated/3.3-blog3/image/image5.png alt=image5.png>![][image6]</strong></td></tr><tr><td style=text-align:left><strong>PostgreSQL</strong></td></tr></tbody></table><p>| <strong>SELECT p.productdescriptionid ,p.description, ts_rank(to_tsvector(&lsquo;pg_catalog.english&rsquo;,p.Description), query) AS rank, ts_headline(&lsquo;pg_catalog.english&rsquo;,p.Description,query) headline FROM production.productdescription p, to_tsquery(&lsquo;pg_catalog.english&rsquo;,&lsquo;gear&rsquo;) query WHERE query @@ to_tsvector(&lsquo;pg_catalog.english&rsquo;,p.Description) ORDER BY rank desc,p.productdescriptionid; <img src=/learning-aws/3-blogstranslated/3.3-blog3/image/image15.png alt=image15.png></strong></p><h2 id=improving-query-performance-in-postgresql><strong>Improving query performance in PostgreSQL</strong></h2><p>For the sample PostgreSQL queries shown previously, the to_tsvector function retrieves tsvector values from the Description column in the productdescription table. In the following sections, we will introduce you to various options to improve query performance.</p><h3 id=solution-1-using-gin-index><strong>Solution 1: Using GIN index</strong></h3><p>A GIN (Generalized Inverted Index) in PostgreSQL is a popular indexing method used to efficiently speed up searching for complex data types such as JSON and full-text search. Standard database indexes, a B-tree, are designed to check for equality, while GIN is designed for search patterns that operate on nested or aggregate data structures, allowing more expressive search patterns. By indexing the components of complex data types separately, GIN indexes enable faster queries on arrays, JSON data, and text search operations. This makes GIN indexes a useful tool for improving the performance of queries related to complex data structures in PostgreSQL databases.</p><p><a href=https://www.postgresql.org/docs/current/gin-intro.html>In this approach, you create a GIN index</a> based on an expression on the column of interest in the product description table.</p><ol><li>Run the following command:</li></ol><p>CREATE INDEX productdescription_gin_idx ON production.productdescription</p><ol start=2><li>USING GIN (to_tsvector(&lsquo;pg_catalog.english&rsquo;, Description));</li><li>If the table has millions of rows, you can increase the maintenance_work_mem configuration parameter at the session level to speed up index creation time. maintenance_work_mem specifies the maximum amount of memory in MB that will be used for maintenance operations such as creating INDEX—by default (PostgreSQL), it is 64 MB.</li><li>Run the following EXPLAIN ANALYZE query:</li></ol><p>EXPLAIN ANALYZE</p><p>SELECT * FROM production.productdescription</p><p>WHERE to_tsvector(&lsquo;pg_catalog.english&rsquo;, Description) @@ to_tsquery(&lsquo;pg_catalog.english&rsquo;,&rsquo;entry | level&rsquo;)</p><ol start=5><li>ORDER BY productdescriptionid DESC;</li></ol><p>The output shows that a bitmap index scan is being performed on productdescription_gin_index, improving query performance. The following screenshot shows the explain plan before creating the index.</p><p><img src=/learning-aws/3-blogstranslated/3.3-blog3/image/image13.png alt=image13.png></p><p>The following screenshot shows the explain plan after creating the index.</p><p><img src=/learning-aws/3-blogstranslated/3.3-blog3/image/image7.png alt=image7.png></p><p>In this case, we can see that query performance is improved when using the GIN index. Although generally, using GIN indexes for full-text search in PostgreSQL can help improve performance, you need to be aware of other performance trade-offs, including the time required to build the index and the additional storage space that the index requires.</p><h3 id=solution-2-using-stored-generated-column><strong>Solution 2: Using stored generated column</strong></h3><p>In this approach, you create a computed column description_tsv containing tsvector values from the description column in the table followed by a GIN index on the computed column.</p><ol><li>Run the following commands:</li></ol><p>ALTER TABLE production.productdescription</p><p>ADD COLUMN description_tsv tsvector</p><p>GENERATED ALWAYS AS (to_tsvector(&lsquo;pg_catalog.english&rsquo;,Description )) STORED;</p><ol start=2><li>CREATE INDEX productdescription_gin_idx ON production.productdescription USING GIN(description_tsv);</li><li>Run the following sample EXPLAIN ANALYZE query:</li></ol><p>EXPLAIN ANALYZE</p><p>SELECT *</p><p>FROM production.productdescription</p><p>WHERE description_tsv @@ to_tsquery(&lsquo;pg_catalog.english&rsquo;,&rsquo;entry | level&rsquo;)</p><ol start=4><li>ORDER BY productdescriptionid DESC;</li></ol><p>The output shows that a bitmap index scan is being performed on productdescription_gin_index, in this case demonstrating improved query performance:</p><p><img src=/learning-aws/3-blogstranslated/3.3-blog3/image/image4.png alt=image4.png></p><h2 id=full-text-search-in-postgresql-using-the-pg_><strong>Full-text search in PostgreSQL using the pg_trgm extension</strong></h2><p>In PostgreSQL, the pg_trgm extension is implemented for text search functions using trigrams. A trigram is essentially a set of three consecutive characters extracted from a given string. By using trigrams, users can identify similarity or matches in text patterns within strings by comparing the number of matching trigrams between strings, along with a predefined similarity threshold parameter set before performing the search.</p><p>The pg_trgm extension provides operators that can be used to create trigram indexes on text columns in tables that need to be searched. This index enables efficient similarity operations on indexed columns. The extension provides three similarity operators: similarity (%), word_similarity (&lt;%), and strict_word_similarity (&lt;&lt;%). The threshold parameters for the respective operators are pg_trgm.similarity_threshold, pg_trgm.word_similarity_threshold, and pg_trgm.strict_word_similarity_threshold, which can be set to values from 0 (no similarity) to 1 (perfect match). The similarity(), word_similarity(), and strict_word_similarity() functions are used to calculate similarity scores. You can use pg_trgm as in the following code snippet:</p><ol><li>Run the following command to create the pg_trgm extension:<br>CREATE EXTENSION pg_trgm;</li><li>Run the following command to create a GIN index on the productdescription column:</li><li>CREATE INDEX productdescription_trgm_idx ON production.productdescription USING GIN (Description gin_trgm_ops);</li><li>Run the following command to set the similarity_threshold configuration value to 0.2. The similarity feature will check for common trigrams between two strings and return a value from 0–1.</li></ol><p>SET pg_trgm.similarity_threshold = 0.2;</p><p>SET enable_seqscan = off;</p><p>SELECT productdescriptionid, Description, similarity(Description, &rsquo;entry level&rsquo;) AS sml</p><p>FROM production.product description</p><p>WHERE Description % &rsquo;entry level&rsquo;</p><ol start=5><li>ORDER BY sml DESC, Description;</li><li><img src=/learning-aws/3-blogstranslated/3.3-blog3/image/image9.png alt=image9.png></li><li>Run the following command to set the word_similarity_threshold configuration value to 0.6. word_similarity checks for common trigrams between strings at the word level.</li></ol><p>SET pg_trgm.word_similarity_threshold = 0.6;</p><p>SET enable_seqscan = off;</p><p>SELECT productdescriptionid, Description, word_similarity(&rsquo;entry level&rsquo;, Description) AS sml</p><p>FROM production.productdescription</p><p>WHERE &rsquo;entry level&rsquo; &lt;% Description</p><ol start=8><li>ORDER BY sml DESC, Description;</li><li><img src=/learning-aws/3-blogstranslated/3.3-blog3/image/image11.png alt=image11.png></li><li>Run the following command to set the strict_word_similarity_threshold configuration value to 0.6. strict_word_similarity is similar to word_similarity but it only considers common trigrams when both words are identical.</li></ol><p>SET pg_trgm.strict_word_similarity_threshold = 0.6;</p><p>SET enable_seqscan = off;</p><p>SELECT productdescriptionid, Description, strict_word_similarity(&lsquo;aluminum cups and hollow axle&rsquo;, Description) AS sml</p><p>FROM production.productdescription</p><p>WHERE &rsquo;entry level&rsquo; &lt;&lt;% Description</p><ol start=11><li>ORDER BY sml DESC, Description;</li><li><img src=/learning-aws/3-blogstranslated/3.3-blog3/image/image8.png alt=image8.png></li><li>Run the following command to drop the index and enable sequential scan:</li><li>DROP INDEX production.productdescription_trgm_idx;</li></ol><h2 id=full-text-search-in-postgresql-using-the-pg_-1><strong>Full-text search in PostgreSQL using the pg_bigm extension</strong></h2><p>The pg_bigm extension in PostgreSQL enhances full-text search capabilities, especially for languages with complex character sets such as Asian languages.</p><p>A bigram is a group of two consecutive characters taken from a string. This extension uses a bigram indexing method, which involves dividing text into consecutive character pairs and building an index based on these bigrams. The pg_bigm extension provides the bigm_similarity() function, the bigm similarity operator = %, and the pg_bigm.similarity_limit threshold parameter. You can use pg_bigm as follows:</p><ol><li>Run the following command to create the pg_bigm extension. For instructions on creating extensions in Amazon RDS for PostgreSQL, refer to the article <a href=https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Appendix.PostgreSQL.CommonDBATasks.Extensions.html>Using PostgreSQL extensions with Amazon RDS for PostgreSQL</a> .</li><li>CREATE EXTENSION pg_bigm;</li><li>Run the following command to create a GIN index on the productdescription column:</li><li>CREATE INDEX productdescription_bigm_idx ON production.productdescription USING gin (Description gin_bigm_ops);</li><li>Run the following command to set the similarity_limit configuration value to 0.15. The similarity check finds common bigrams between two strings and returns a value from 0–1.</li></ol><p>SET pg_bigm.similarity_limit TO 0.15;</p><p>SELECT *,bigm_similarity(Description, &lsquo;%entry level%&rsquo;) rank1</p><p>FROM production.productdescription</p><p>WHERE Description =% &lsquo;%entry level%&rsquo;</p><ol start=6><li>ORDER BY rank1 DESC;</li><li><img src=/learning-aws/3-blogstranslated/3.3-blog3/image/image3.png alt=image3.png></li><li>Run the following command to drop the index and enable sequential scan:</li></ol><p>DROP INDEX production.productdescription_bigm_idx;</p><ol start=9><li>SET enable_seqscan = on;</li></ol><h2 id=conclusion><strong>Conclusion</strong></h2><p>In this article, we have guided you on how to migrate FTS from SQL Server to PostgreSQL and compared some common use cases. Migrating full-text search from SQL Server to PostgreSQL requires manual code rewriting. To learn more, please refer to the <a href=https://www.postgresql.org/docs/13/textsearch-limitations.html>limitations of text search features in PostgreSQL</a> . We have also guided you on how to use the pg_trgm and pg_bigm extensions in PostgreSQL to implement FTS.</p><h3></h3><p><strong>About the authors</strong></p><p><img src=/learning-aws/3-blogstranslated/3.3-blog3/image/image2.jpg alt=image2.jpg>![][image15]</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/learning-aws/3-blogstranslated/3.2-blog2/ title="Blog 2"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/learning-aws/4-eventparticipated/ title="Events Participated" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1e3px;overflow:scroll;position:absolute;top:-1e3px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/learning-aws/js/clipboard.min.js?1765009877></script><script src=/learning-aws/js/perfect-scrollbar.min.js?1765009877></script><script src=/learning-aws/js/perfect-scrollbar.jquery.min.js?1765009877></script><script src=/learning-aws/js/jquery.sticky.js?1765009877></script><script src=/learning-aws/js/featherlight.min.js?1765009877></script><script src=/learning-aws/js/highlight.pack.js?1765009877></script><script>hljs.initHighlightingOnLoad()</script><script src=/learning-aws/js/modernizr.custom-3.6.0.js?1765009877></script><script src=/learning-aws/js/learn.js?1765009877></script><script src=/learning-aws/js/hugo-learn.js?1765009877></script><script src=/learning-aws/mermaid/mermaid.js?1765009877></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>